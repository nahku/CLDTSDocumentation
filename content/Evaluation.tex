%!TEX root = ../dokumentation.tex
\chapter{Validation}\label{sec:Validation}

show advantages and useful for tptp users...
show size before after 

\section{Comment association}\label{sec:ValidationCommentAssociation}

todo comment association

\section{Automated parser generation}\label{sec:ValidationAutomatedParserGeneration}

A goal of using \ac{Synplifier} is to be able to use an extracted sub-syntax with the automated parser generator for the \ac{TPTP} syntax \cite{VS06}.
To ensure compatibility it is possible to export an extracted sub-syntax and adding the part of the syntax concerning comments, even though it is not reachable in the original syntax (see section \ref{sec:ConceptAutomatedParserGenerator}). If this part of the syntax would not be part of the output sub-syntax file automated parser generation would result in an error because this syntax part is expected to be present.\\
Also, the automated parser generator is used to check if the output sub-syntax follows the original \ac{TPTP} syntax format.

\subsection{Building a basic parser}\label{sec:ValidationAutomatedParserGenerationBuildingBasicParser}

To demonstrate the usability and capability of \ac{Synplifier} a parser parsing only \ac{CNF}, that counts the number of \ac{CNF} clauses, is used.
The creation of the parser can be divided in the following steps:
\begin{enumerate}%[noitemsep]
	\item Extract the \ac{CNF} sub-syntax from the original \ac{TPTP} syntax using \ac{Synplifier}.
	\item Generate lex and yacc file based on the sub-syntax using the automated parser generator.
	\item Modify the generated yacc parser to count \ac{CNF} clauses.
\end{enumerate}

\subsubsection{\ac{CNF} sub-syntax extraction}\label{sec:ValidationAutomatedParserGenerationBuildingBasicParserSubSyntax}

The following listing \ref{lst:ValidationParserControlFile} contains the control file content, that extracts \ac{CNF} from the TPTP syntax version 7.3.0.0.
The start symbol is \textit{TPTP\textunderscore file}.
\begin{lstlisting}[language = None, caption= Control file to extract \ac{CNF}, label= lst:ValidationParserControlFile]
<TPTP_file>
<annotated_formula>,::=,0,1,2,3,5
<annotations>,::=,0
\end{lstlisting}

All productions except the \textit{cnf\textunderscore annotated} are disabled from the \textit{annotated\textunderscore formula} grammar rule (line 2 of listing \ref{lst:ValidationParserControlFile}).
The \textit{annotated\textunderscore formula} grammar rule can be seen in the following listing \ref{lst:ValidationParserAnnotatedFormulaProductions}.
\begin{lstlisting}[language = None,caption= \textit{annotated\textunderscore formula} production rule, label= lst:ValidationParserAnnotatedFormulaProductions]
<annotated_formula>    ::= <thf_annotated> | <tff_annotated> | <tcf_annotated> |
                           <fof_annotated> | <cnf_annotated> | <tpi_annotated>
\end{lstlisting}

todo describe annotations rule

To extract the \ac{CNF} sub-syntax using the control file content from listing \ref{lst:ValidationParserControlFile} either the command-line interface or the GUI can be used.

\subsubsection{Lex and yacc file generation}\label{sec:ValidationAutomatedParserGenerationBuildingBasicParserGenerateFiles}

The generated sub-syntax is input to the automated parser generator.
The automated parser generates  a lex and yacc file, and also the corresponding c files from that.

\subsubsection{\ac{CNF} clause counter implementation}\label{sec:ValidationAutomatedParserGenerationBuildingBasicParserClauseCounter}

To count the \ac{CNF} clauses the counter $cnf\textunderscore counter$ has been added to the parser.
Also a main function is added, that can be seen in listing \ref{lst:ValidationParserMainFunction}.
Using this function, either a file can be passed to the parser, or the input can be provided via the command-line.
After parsing is complete, the total number of \ac{CNF} clauses is output to the console.

\begin{lstlisting}[language=c, basicstyle=\scriptsize	,caption= \ac{CNF} parser main-function,label= lst:ValidationParserMainFunction]
 int main(int argc, char **argv ){
    ++argv, --argc;  /* skip over program name */
    if(argc>0){
        yyin = fopen(argv[0],"r");
    }
    else{
        yyin = stdin;
    }
    yyparse();
    printf("Total count of cnf clauses: %d\n", cnf_counter);
}
\end{lstlisting}
The incrementation of the \textit{cnf\textunderscore counter} is done in the yacc rule-action, that has been created  by the automated parser generator, for the \textit{cnf\textunderscore annotated} symbol.

\subsection{Testing the generated parser}\label{sec:ValidationAutomatedParserGeneration}

The generated parser has been successfully tested on \ac{TPTP} problems.
It returns an error if other logics than \ac{CNF} are present and correctly counts the number of \ac{CNF} clauses.

The automated parser generator can be used with any sub-syntax generated by \ac{Synplifier}, for example sub-syntaxes with \ac{FOF}, or \ac{FOF} and \ac{CNF}.

\section{Syntax size comparison}\label{sec:ValidationSyntaxSizeComparison}

Based on the extracted CNF and FOF sub-syntax, the size of the sub-syntaxes in comparison to the full TPTP syntax is analyzed.
Table \ref{tbl:EvaluationSyntaxSize} contains the number of rule statements and rules of the original TPTP syntax and extracted sub-syntaxes.\\
A rule statement in this case means the combination of left hand side non-terminal symbol, rule type and rule alternatives.
Since rule alternatives are just a convenient way to display multiple rules with same non-terminal symbol on the left hand side and the same rule type, in addition to the number of rule statements the number of rules is compared.\\
The reachable part of the TPTP syntax in the second row of the table contains only the reachable symbols counted from the start symbol \textit{\textless TPTP\textunderscore file\textgreater}. Rule statements are counted by counting the nodes in grammar graph and the number of rules is counted by counting the productions list entries of all nodes.\\
Table \ref{tbl:EvaluationSyntaxSize} implies that the FOF sub-syntax contains only 35 \% of the rule statements of the full syntax.
The CNF sub-syntax contains only circa 30 \% of the rule statements of the full syntax.
Compared with the total number of reachable rules in the TPTP syntax, FOF contains circa 33 \% of the total reachable rules and CNF contains circa  28 \% of the total reachable rules.
This shows a significant syntax reduction which was one goal of the tool usage.

\begin{table}[H]
\centering
\caption{TPTP syntax size comparison}
\begin{tabular}{lll}
\textbf{Syntax} & \textbf{Rules} & \textbf{Productions}\\\hline
TPTP syntax v. 7.3.0 & 313 & 635\\
Reachable part of TPTP syntax v. 7.3.0 & 285 & 595\\
FOF & 108 & 198\\
CNF & 92 & 165\\
\end{tabular}
\label{tbl:EvaluationSyntaxSize}
\end{table}
